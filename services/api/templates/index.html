<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdsGen 2.0 - Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
            --text-muted: #94a3b8;
            --border: #334155;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --glass: rgba(30, 41, 59, 0.7);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg);
            background-image:
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(139, 92, 246, 0.15) 0px, transparent 50%);
            color: var(--text);
            min-height: 100vh;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* HEADER & NAVIGATION */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border);
            background: var(--glass);
            backdrop-filter: blur(12px);
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            /* Fallback */
        }

        .nav-tabs {
            display: flex;
            gap: 8px;
        }

        .nav-tab {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .step-mode-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            font-size: 13px;
        }

        .toggle {
            width: 44px;
            height: 24px;
            background: var(--border);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle.active {
            background: var(--success);
        }

        .toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: left 0.3s;
        }

        .toggle.active::after {
            left: 22px;
        }

        /* Toggle Switch (checkbox-based) */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 22px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border);
            transition: 0.3s;
            border-radius: 22px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked+.toggle-slider {
            background: var(--success);
        }

        .toggle-switch input:checked+.toggle-slider:before {
            transform: translateX(18px);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* MAIN CONTENT */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        .main {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* DASHBOARD */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--glass);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .stat-card h3 {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
        }

        .stat-card.pending .value {
            color: var(--warning);
        }

        .stat-card.processing .value {
            color: var(--info);
        }

        .stat-card.completed .value {
            color: var(--success);
        }

        .stat-card.error .value {
            color: var(--error);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* VACANCIES TABLE */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        .panel {
            background: var(--glass);
            backdrop-filter: blur(12px);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .panel-title {
            font-size: 18px;
            font-weight: 600;
        }

        .filters {
            display: flex;
            gap: 10px;
        }

        .filter-input {
            padding: 8px 12px;
            background: #0f172a;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 13px;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .status-text_generating,
        .status-image_generating,
        .status-validating,
        .status-publishing {
            background: rgba(99, 102, 241, 0.2);
            color: #818cf8;
        }

        .status-text_generated,
        .status-image_generated,
        .status-validated,
        .status-published {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .status-error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .action-btn {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            cursor: pointer;
            font-size: 12px;
            margin-right: 4px;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .action-btn.danger:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--error);
        }

        .action-btn.primary {
            background: var(--primary);
            border-color: var(--primary);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 1rem;
        }

        .page-btn {
            padding: 8px 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            cursor: pointer;
        }

        .page-btn.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* MODAL */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--card);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid var(--border);
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group.full {
            grid-column: span 2;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 14px;
            background: #0f172a;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 14px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        /* Worker buttons */
        .worker-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .worker-btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .worker-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
        }

        .worker-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* IMPORT TAB */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        .import-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 900px) {
            .import-section {
                grid-template-columns: 1fr;
            }
        }

        .import-card {
            background: var(--glass);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .import-card h3 {
            margin-bottom: 1rem;
            font-size: 16px;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            z-index: 2000;
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--error);
        }

        .toast.info {
            background: var(--info);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Links */
        .links {
            display: flex;
            gap: 20px;
            margin-top: 2rem;
            justify-content: center;
        }

        .links a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 14px;
        }

        .links a:hover {
            color: var(--primary);
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">AdsGen 2.0 ğŸš€</div>
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">ğŸ“Š Dashboard</button>
            <button class="nav-tab" onclick="switchTab('vacancies')">ğŸ“‹ Ğ’Ğ°ĞºĞ°Ğ½ÑĞ¸Ğ¸</button>
            <button class="nav-tab" onclick="switchTab('import')">ğŸ“¥ Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚</button>
            <button class="nav-tab" onclick="switchTab('settings')">âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</button>
        </nav>
        <div class="header-actions">
            <div class="step-mode-toggle">
                <span>Step Mode</span>
                <div class="toggle" id="stepModeToggle" onclick="toggleStepMode()"></div>
            </div>
        </div>
    </header>

    <main class="main">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <h3>Ğ’ÑĞµĞ³Ğ¾ Ğ²Ğ°ĞºĞ°Ğ½ÑĞ¸Ğ¹</h3>
                    <div class="value" id="statTotal">-</div>
                </div>
                <div class="stat-card pending">
                    <h3>ĞĞ¶Ğ¸Ğ´Ğ°ÑÑ‚</h3>
                    <div class="value" id="statPending">-</div>
                </div>
                <div class="stat-card processing">
                    <h3>Ğ’ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ</h3>
                    <div class="value" id="statProcessing">-</div>
                </div>
                <div class="stat-card completed">
                    <h3>Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ñ‹</h3>
                    <div class="value" id="statCompleted">-</div>
                </div>
                <div class="stat-card error">
                    <h3>ĞÑˆĞ¸Ğ±ĞºĞ¸</h3>
                    <div class="value" id="statError">-</div>
                </div>
            </div>

            <!-- Batch Processing Controls -->
            <div class="panel" style="margin-bottom: 2rem">
                <div class="panel-header">
                    <h2 class="panel-title">ğŸš€ ĞœĞ°ÑÑĞ¾Ğ²Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°</h2>
                </div>
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="startBatchProcessing('PENDING', 100)">
                        ğŸ“ Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚Ñ‹ (PENDING)
                    </button>
                    <button class="btn btn-primary" onclick="startBatchProcessing('TEXT_GENERATED', 100)">
                        ğŸ–¼ï¸ Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ¸ (TEXT_GENERATED)
                    </button>
                    <button class="btn btn-secondary" onclick="loadStats()">
                        ğŸ”„ ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ
                    </button>
                </div>
                <div id="batchResult" style="margin-top: 1rem; font-size: 13px; color: var(--text-muted)"></div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ²Ğ°ĞºĞ°Ğ½ÑĞ¸Ğ¸</h2>
                    <button class="action-btn" onclick="loadVacancies()">ğŸ”„ ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ</button>
                </div>
                <div id="recentVacancies">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>
            </div>

            <div class="links">
                <a href="/docs" target="_blank">ğŸ“š API Docs</a>
                <a href="http://localhost:5555" target="_blank">ğŸ“Š Flower Monitor</a>
            </div>
        </div>

        <!-- Vacancies Tab -->
        <div id="vacancies" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">Ğ’ÑĞµ Ğ²Ğ°ĞºĞ°Ğ½ÑĞ¸Ğ¸</h2>
                    <div class="filters">
                        <select class="filter-input" id="statusFilter" onchange="loadVacancies()">
                            <option value="">Ğ’ÑĞµ ÑÑ‚Ğ°Ñ‚ÑƒÑÑ‹</option>
                            <option value="pending">Pending</option>
                            <option value="text_generated">Text Generated</option>
                            <option value="image_generated">Image Generated</option>
                            <option value="validated">Validated</option>
                            <option value="published">Published</option>
                            <option value="error">Error</option>
                        </select>
                        <input type="text" class="filter-input" id="cityFilter" placeholder="Ğ“Ğ¾Ñ€Ğ¾Ğ´..."
                            onkeyup="loadVacancies()">
                        <button class="action-btn" onclick="loadVacancies()">ğŸ”„</button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ</th>
                            <th>Ğ“Ğ¾Ñ€Ğ¾Ğ´</th>
                            <th>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</th>
                            <th>Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½</th>
                            <th>Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</th>
                        </tr>
                    </thead>
                    <tbody id="vacanciesTable">
                    </tbody>
                </table>
                <div class="pagination" id="pagination"></div>
            </div>
        </div>

        <!-- Import Tab -->
        <div id="import" class="tab-content">
            <!-- Saved Sources Section -->
            <div class="panel" style="margin-bottom: 2rem;">
                <div class="panel-header">
                    <h2 class="panel-title">ğŸ“‚ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸</h2>
                    <button class="action-btn" onclick="loadSources()">ğŸ”„ ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ</button>
                </div>
                <div id="sourcesList">
                    <p style="color:var(--text-muted)">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</p>
                </div>
            </div>

            <div class="import-section">
                <div class="import-card">
                    <h3>ğŸ“Š Google Sheets Import</h3>
                    <div class="form-group">
                        <label>URL Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹</label>
                        <input type="text" id="sheetUrl" placeholder="https://docs.google.com/spreadsheets/d/...">
                    </div>
                    <button class="btn btn-secondary" onclick="loadSheets()">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ»Ğ¸ÑÑ‚Ñ‹</button>
                    <div id="sheetOptions" style="margin-top: 1rem;"></div>
                </div>

                <div class="import-card">
                    <h3>ğŸ“ Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ *</label>
                            <input type="text" id="manualPosition" placeholder="ĞŸÑ€Ğ¾Ğ´Ğ°Ğ²ĞµÑ†-ĞºĞ°ÑÑĞ¸Ñ€">
                        </div>
                        <div class="form-group">
                            <label>Ğ“Ğ¾Ñ€Ğ¾Ğ´ *</label>
                            <input type="text" id="manualCity" placeholder="ĞœĞ¾ÑĞºĞ²Ğ°">
                        </div>
                        <div class="form-group full">
                            <label>ĞĞ´Ñ€ĞµÑ</label>
                            <input type="text" id="manualAddress" placeholder="ÑƒĞ». Ğ›ĞµĞ½Ğ¸Ğ½Ğ°, 1">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="manualImport()">ğŸš€ Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ</button>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="import-section">
                <div class="import-card">
                    <h3>ğŸ¢ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸</h3>
                    <p style="color:var(--text-muted);margin-bottom:1rem;font-size:13px">
                        Ğ­Ñ‚Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ÑÑ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¸ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğµ Ğ² XML
                    </p>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Ğ˜Ğ¼Ñ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ°</label>
                            <input type="text" id="profileManagerName" placeholder="ĞĞ½Ğ°ÑÑ‚Ğ°ÑĞ¸Ñ">
                        </div>
                        <div class="form-group">
                            <label>Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ°</label>
                            <input type="text" id="profilePhone" placeholder="79082348946">
                        </div>
                        <div class="form-group">
                            <label>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸</label>
                            <input type="text" id="profileCompanyName" placeholder="ĞŸÑ€Ğ¾ĞµĞºÑ‚ÑÑ‚Ñ€Ğ¾Ğ¹-8">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="text" id="profileEmail" placeholder="company@mail.ru">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="saveProfile()">ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</button>
                </div>

                <div class="import-card">
                    <h3>ğŸ“¤ Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ XML</h3>
                    <p style="color:var(--text-muted);margin-bottom:1rem;font-size:13px">
                        Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğµ Ğ²Ğ°ĞºĞ°Ğ½ÑĞ¸Ğ¸ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Avito XML
                    </p>
                    <button class="btn btn-primary" onclick="exportXML()">ğŸš€ Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑĞµ</button>
                    <div id="exportResult" style="margin-top:1rem"></div>
                </div>

                <div class="import-card" style="margin-top:1rem">
                    <h3>ğŸ“… ĞĞ²Ñ‚Ğ¾-Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ</h3>
                    <p style="color:var(--text-muted);margin-bottom:1rem;font-size:13px">
                        ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ²Ñ‹Ğ³Ñ€ÑƒĞ·ĞºĞ¸ XML Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ
                    </p>
                    
                    <div class="form-group" style="display:flex;align-items:center;gap:10px">
                        <label class="toggle-switch" style="margin:0">
                            <input type="checkbox" id="pubScheduleEnabled" onchange="togglePubSchedule()">
                            <span class="toggle-slider"></span>
                        </label>
                        <label for="pubScheduleEnabled" style="margin:0;cursor:pointer">Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</label>
                    </div>

                    <div id="pubScheduleSettings" style="display:none; margin-top:1rem; padding-top:1rem; border-top:1px solid var(--border)">
                        <div class="form-group">
                            <label>Ğ”Ğ½Ğ¸ Ğ½ĞµĞ´ĞµĞ»Ğ¸</label>
                            <div style="display:flex;gap:6px;flex-wrap:wrap">
                                <label class="worker-btn" style="cursor:pointer;padding:6px 10px"><input type="checkbox" class="pub-day" value="0"> ĞŸĞ½</label>
                                <label class="worker-btn" style="cursor:pointer;padding:6px 10px"><input type="checkbox" class="pub-day" value="1"> Ğ’Ñ‚</label>
                                <label class="worker-btn" style="cursor:pointer;padding:6px 10px"><input type="checkbox" class="pub-day" value="2"> Ğ¡Ñ€</label>
                                <label class="worker-btn" style="cursor:pointer;padding:6px 10px"><input type="checkbox" class="pub-day" value="3"> Ğ§Ñ‚</label>
                                <label class="worker-btn" style="cursor:pointer;padding:6px 10px"><input type="checkbox" class="pub-day" value="4"> ĞŸÑ‚</label>
                                <label class="worker-btn" style="cursor:pointer;padding:6px 10px"><input type="checkbox" class="pub-day" value="5"> Ğ¡Ğ±</label>
                                <label class="worker-btn" style="cursor:pointer;padding:6px 10px"><input type="checkbox" class="pub-day" value="6"> Ğ’Ñ</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Ğ§Ğ°ÑÑ‹ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° (ĞœĞ¡Ğš)</label>
                            <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(45px, 1fr));gap:6px">
                                <!-- Generated by JS for brevity or inline -->
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="0"> 00</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="1"> 01</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="2"> 02</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="3"> 03</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="4"> 04</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="5"> 05</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="6"> 06</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="7"> 07</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="8"> 08</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="9"> 09</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="10"> 10</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="11"> 11</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="12"> 12</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="13"> 13</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="14"> 14</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="15"> 15</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="16"> 16</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="17"> 17</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="18"> 18</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="19"> 19</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="20"> 20</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="21"> 21</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="22"> 22</label>
                                <label class="worker-btn" style="cursor:pointer;justify-content:center"><input type="checkbox" class="pub-hour" value="23"> 23</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel" style="margin-top:2rem">
                <div class="panel-header">
                    <h2 class="panel-title">âš™ï¸ Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</h2>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Ğ¢Ğ¸Ğ¿ Ğ·Ğ°Ğ½ÑÑ‚Ğ¾ÑÑ‚Ğ¸</label>
                        <select class="filter-input" id="profileEmploymentType">
                            <option value="ĞŸĞ¾Ğ»Ğ½Ğ°Ñ">ĞŸĞ¾Ğ»Ğ½Ğ°Ñ</option>
                            <option value="Ğ§Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ°Ñ">Ğ§Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ°Ñ</option>
                            <option value="Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ">Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ</option>
                            <option value="Ğ¡Ñ‚Ğ°Ğ¶Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°">Ğ¡Ñ‚Ğ°Ğ¶Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹</label>
                        <select class="filter-input" id="profileJobType">
                            <option value="Ğ“Ğ¸Ğ±ĞºĞ¸Ğ¹">Ğ“Ğ¸Ğ±ĞºĞ¸Ğ¹</option>
                            <option value="Ğ¡Ğ¼ĞµĞ½Ğ½Ñ‹Ğ¹">Ğ¡Ğ¼ĞµĞ½Ğ½Ñ‹Ğ¹</option>
                            <option value="Ğ¤Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹">Ğ¤Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹</option>
                            <option value="Ğ’Ğ°Ñ…Ñ‚Ğ°">Ğ’Ğ°Ñ…Ñ‚Ğ°</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ĞĞ¿Ñ‹Ñ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹</label>
                        <select class="filter-input" id="profileExperience">
                            <option value="Ğ‘ĞµĞ· Ğ¾Ğ¿Ñ‹Ñ‚Ğ°">Ğ‘ĞµĞ· Ğ¾Ğ¿Ñ‹Ñ‚Ğ°</option>
                            <option value="Ğ‘Ğ¾Ğ»ĞµĞµ 1 Ğ³Ğ¾Ğ´Ğ°">Ğ‘Ğ¾Ğ»ĞµĞµ 1 Ğ³Ğ¾Ğ´Ğ°</option>
                            <option value="Ğ‘Ğ¾Ğ»ĞµĞµ 3 Ğ»ĞµÑ‚">Ğ‘Ğ¾Ğ»ĞµĞµ 3 Ğ»ĞµÑ‚</option>
                            <option value="Ğ‘Ğ¾Ğ»ĞµĞµ 5 Ğ»ĞµÑ‚">Ğ‘Ğ¾Ğ»ĞµĞµ 5 Ğ»ĞµÑ‚</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ĞŸĞµÑ€Ğ¸Ğ¾Ğ´ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹</label>
                        <select class="filter-input" id="profilePayPeriod">
                            <option value="Ğ·Ğ° ÑĞ¼ĞµĞ½Ñƒ">Ğ·Ğ° ÑĞ¼ĞµĞ½Ñƒ</option>
                            <option value="Ğ² Ğ¼ĞµÑÑÑ†">Ğ² Ğ¼ĞµÑÑÑ†</option>
                            <option value="Ğ² Ñ‡Ğ°Ñ">Ğ² Ñ‡Ğ°Ñ</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal for viewing/editing vacancy -->
    <div class="modal-overlay" id="vacancyModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Ğ’Ğ°ĞºĞ°Ğ½ÑĞ¸Ñ <span id="modalVacancyId"></span></h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label>Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ</label>
                    <input type="text" id="editPosition">
                </div>
                <div class="form-group">
                    <label>ĞŸÑ€Ğ¾Ñ„ĞµÑÑĞ¸Ñ (Avito)</label>
                    <input type="text" id="editProfession">
                </div>
                <div class="form-group">
                    <label>Ğ“Ğ¾Ñ€Ğ¾Ğ´</label>
                    <input type="text" id="editCity">
                </div>
                <div class="form-group">
                    <label>ĞĞ´Ñ€ĞµÑ</label>
                    <input type="text" id="editAddress">
                </div>
                <div class="form-group full">
                    <label>Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº (ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹)</label>
                    <input type="text" id="editTitle">
                </div>
                <div class="form-group full">
                    <label>ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</label>
                    <textarea id="editDescription" rows="5"></textarea>
                </div>
                <div class="form-group full">
                    <label>URL ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ¸</label>
                    <input type="text" id="editImageUrl">
                </div>
                <div class="form-group">
                    <label>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</label>
                    <input type="text" id="editStatus" disabled>
                </div>
                <div class="form-group">
                    <label>ĞÑˆĞ¸Ğ±ĞºĞ°</label>
                    <input type="text" id="editError" disabled>
                </div>
            </div>

            <div class="worker-actions">
                <span style="color: var(--text-muted); font-size: 13px;">Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ:</span>
                <button class="worker-btn" onclick="runWorker('generate-text')">ğŸ“ Text</button>
                <button class="worker-btn" onclick="runWorker('generate-image')">ğŸ–¼ï¸ Image</button>
                <button class="worker-btn" onclick="runWorker('validate')">âœ… Validate</button>
                <button class="worker-btn" onclick="runWorker('publish')">ğŸ“¤ Publish</button>
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="deleteCurrentVacancy()">ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ</button>
                <button class="btn btn-primary" onclick="saveVacancy()">ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
            </div>
        </div>
    </div>

    <!-- Modal for schedule settings -->
    <div class="modal-overlay" id="scheduleModal" style="display:none">
        <div class="modal" style="max-width:450px">
            <div class="modal-header">
                <h2 class="modal-title">â° Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸</h2>
                <button class="modal-close" onclick="closeScheduleModal()">&times;</button>
            </div>
            <div class="form-grid">
                <div class="form-group full">
                    <label>Ğ¢Ğ¸Ğ¿ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ</label>
                    <select class="filter-input" id="scheduleType" onchange="toggleDaysSelector()">
                        <option value="daily">Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾</option>
                        <option value="weekly">ĞŸĞ¾ Ğ´Ğ½ÑĞ¼ Ğ½ĞµĞ´ĞµĞ»Ğ¸</option>
                    </select>
                </div>
                <div class="form-group full">
                    <label>Ğ’Ñ€ĞµĞ¼Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°</label>
                    <select class="filter-input" id="scheduleHour">
                        <option value="0">00:00</option>
                        <option value="1">01:00</option>
                        <option value="2">02:00</option>
                        <option value="3">03:00</option>
                        <option value="4">04:00</option>
                        <option value="5">05:00</option>
                        <option value="6">06:00</option>
                        <option value="7">07:00</option>
                        <option value="8">08:00</option>
                        <option value="9" selected>09:00</option>
                        <option value="10">10:00</option>
                        <option value="11">11:00</option>
                        <option value="12">12:00</option>
                        <option value="13">13:00</option>
                        <option value="14">14:00</option>
                        <option value="15">15:00</option>
                        <option value="16">16:00</option>
                        <option value="17">17:00</option>
                        <option value="18">18:00</option>
                        <option value="19">19:00</option>
                        <option value="20">20:00</option>
                        <option value="21">21:00</option>
                        <option value="22">22:00</option>
                        <option value="23">23:00</option>
                    </select>
                </div>
                <div class="form-group full" id="daysSelector" style="display:none">
                    <label>Ğ”Ğ½Ğ¸ Ğ½ĞµĞ´ĞµĞ»Ğ¸</label>
                    <div style="display:flex;gap:8px;flex-wrap:wrap">
                        <label style="display:flex;align-items:center;gap:4px;cursor:pointer">
                            <input type="checkbox" value="1" class="day-checkbox" checked> ĞŸĞ½
                        </label>
                        <label style="display:flex;align-items:center;gap:4px;cursor:pointer">
                            <input type="checkbox" value="2" class="day-checkbox" checked> Ğ’Ñ‚
                        </label>
                        <label style="display:flex;align-items:center;gap:4px;cursor:pointer">
                            <input type="checkbox" value="3" class="day-checkbox" checked> Ğ¡Ñ€
                        </label>
                        <label style="display:flex;align-items:center;gap:4px;cursor:pointer">
                            <input type="checkbox" value="4" class="day-checkbox" checked> Ğ§Ñ‚
                        </label>
                        <label style="display:flex;align-items:center;gap:4px;cursor:pointer">
                            <input type="checkbox" value="5" class="day-checkbox" checked> ĞŸÑ‚
                        </label>
                        <label style="display:flex;align-items:center;gap:4px;cursor:pointer">
                            <input type="checkbox" value="6" class="day-checkbox"> Ğ¡Ğ±
                        </label>
                        <label style="display:flex;align-items:center;gap:4px;cursor:pointer">
                            <input type="checkbox" value="7" class="day-checkbox"> Ğ’Ñ
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeScheduleModal()">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
                <button class="btn btn-primary" onclick="saveSchedule()">ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
            </div>
        </div>
    </div>

    <script>
        let currentVacancyId = null;
        let currentPage = 1;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TAB NAVIGATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function switchTab(tabId) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');

            if (tabId === 'dashboard') loadStats();
            if (tabId === 'vacancies') loadVacancies();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STEP MODE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function loadStepMode() {
            try {
                const res = await fetch('/settings/step-mode');
                const data = await res.json();
                const toggle = document.getElementById('stepModeToggle');
                if (data.step_mode) {
                    toggle.classList.add('active');
                } else {
                    toggle.classList.remove('active');
                }
            } catch (e) {
                console.error('Failed to load step mode:', e);
            }
        }

        async function toggleStepMode() {
            const toggle = document.getElementById('stepModeToggle');
            const newState = !toggle.classList.contains('active');

            try {
                await fetch('/settings/step-mode', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled: newState })
                });

                if (newState) {
                    toggle.classList.add('active');
                    showToast('Step Mode Ğ²ĞºĞ»ÑÑ‡ĞµĞ½ â€” Ğ²Ğ¾Ñ€ĞºĞµÑ€Ñ‹ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¾ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑˆĞ°Ğ³Ğ°', 'info');
                } else {
                    toggle.classList.remove('active');
                    showToast('Step Mode Ğ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½ â€” Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°', 'info');
                }
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BATCH PROCESSING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function startBatchProcessing(statusFilter, limit = 100) {
            const resultDiv = document.getElementById('batchResult');
            resultDiv.innerHTML = 'â³ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸...';

            try {
                const res = await fetch(`/generate/batch?status_filter=${statusFilter}&limit=${limit}`, {
                    method: 'POST'
                });
                const data = await res.json();

                resultDiv.innerHTML = `âœ… Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ°. ID: <small>${data.task_id}</small>`;
                showToast(`Ğ—Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ° Ñ„Ğ¾Ğ½Ğ¾Ğ²Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° (${statusFilter})`, 'success');

                // Refresh stats after a delay
                setTimeout(loadStats, 2000);
            } catch (e) {
                resultDiv.innerHTML = `âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: ${e.message}`;
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STATS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function loadStats() {
            try {
                const res = await fetch('/stats');
                const data = await res.json();

                document.getElementById('statTotal').textContent = data.total;
                document.getElementById('statPending').textContent = data.by_status.pending || 0;

                const processing = (data.by_status.text_generating || 0) +
                    (data.by_status.image_generating || 0) +
                    (data.by_status.validating || 0) +
                    (data.by_status.publishing || 0);
                document.getElementById('statProcessing').textContent = processing;

                const completed = (data.by_status.published || 0) + (data.by_status.validated || 0);
                document.getElementById('statCompleted').textContent = completed;

                document.getElementById('statError').textContent = data.by_status.error || 0;

                // Load recent vacancies
                loadRecentVacancies();
            } catch (e) {
                console.error('Failed to load stats:', e);
            }
        }

        async function loadRecentVacancies() {
            try {
                const res = await fetch('/vacancies?per_page=5');
                const data = await res.json();

                if (data.items.length === 0) {
                    document.getElementById('recentVacancies').innerHTML = '<p style="color:var(--text-muted)">ĞĞµÑ‚ Ğ²Ğ°ĞºĞ°Ğ½ÑĞ¸Ğ¹</p>';
                    return;
                }

                let html = '<table><thead><tr><th>ID</th><th>Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ</th><th>Ğ“Ğ¾Ñ€Ğ¾Ğ´</th><th>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</th></tr></thead><tbody>';
                data.items.forEach(v => {
                    html += `<tr onclick="openVacancy('${v.id}')" style="cursor:pointer">
                        <td>${v.id}</td>
                        <td>${v.position}</td>
                        <td>${v.city}</td>
                        <td><span class="status-badge status-${v.status}">${v.status}</span></td>
                    </tr>`;
                });
                html += '</tbody></table>';
                document.getElementById('recentVacancies').innerHTML = html;
            } catch (e) {
                document.getElementById('recentVacancies').innerHTML = '<p style="color:var(--error)">ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸</p>';
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // VACANCIES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function loadVacancies() {
            const status = document.getElementById('statusFilter')?.value || '';
            const city = document.getElementById('cityFilter')?.value || '';

            let url = `/vacancies?page=${currentPage}&per_page=20`;
            if (status) url += `&status=${status}`;
            if (city) url += `&city=${city}`;

            try {
                const res = await fetch(url);
                const data = await res.json();

                const tbody = document.getElementById('vacanciesTable');
                if (!tbody) return;

                if (data.items.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--text-muted)">ĞĞµÑ‚ Ğ²Ğ°ĞºĞ°Ğ½ÑĞ¸Ğ¹</td></tr>';
                    return;
                }

                tbody.innerHTML = data.items.map(v => `
                    <tr>
                        <td><code>${v.id}</code></td>
                        <td>${v.position}</td>
                        <td>${v.city}</td>
                        <td><span class="status-badge status-${v.status}">${v.status}</span></td>
                        <td>${new Date(v.created_at).toLocaleDateString('ru')}</td>
                        <td>
                            <button class="action-btn" onclick="openVacancy('${v.id}')">âœï¸</button>
                            <button class="action-btn danger" onclick="deleteVacancy('${v.id}')">ğŸ—‘ï¸</button>
                        </td>
                    </tr>
                `).join('');

                // Pagination
                const totalPages = Math.ceil(data.total / 20);
                const pag = document.getElementById('pagination');
                pag.innerHTML = '';
                for (let i = 1; i <= Math.min(totalPages, 10); i++) {
                    pag.innerHTML += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
                }
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸: ' + e.message, 'error');
            }
        }

        function goToPage(page) {
            currentPage = page;
            loadVacancies();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODAL
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function openVacancy(id) {
            currentVacancyId = id;

            try {
                const res = await fetch(`/vacancies/${id}`);
                const v = await res.json();

                document.getElementById('modalVacancyId').textContent = id;
                document.getElementById('editPosition').value = v.position || '';
                document.getElementById('editProfession').value = v.profession || '';
                document.getElementById('editCity').value = v.city || '';
                document.getElementById('editAddress').value = v.address || '';
                document.getElementById('editTitle').value = v.title || '';
                document.getElementById('editDescription').value = v.description || '';
                document.getElementById('editImageUrl').value = v.image_url || '';
                document.getElementById('editStatus').value = v.status || '';
                document.getElementById('editError').value = v.error_message || '';

                document.getElementById('vacancyModal').classList.add('active');
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ²Ğ°ĞºĞ°Ğ½ÑĞ¸Ğ¸', 'error');
            }
        }

        function closeModal() {
            document.getElementById('vacancyModal').classList.remove('active');
            currentVacancyId = null;
        }

        async function saveVacancy() {
            if (!currentVacancyId) return;

            const updates = {
                position: document.getElementById('editPosition').value,
                profession: document.getElementById('editProfession').value,
                city: document.getElementById('editCity').value,
                address: document.getElementById('editAddress').value,
                title: document.getElementById('editTitle').value,
                description: document.getElementById('editDescription').value,
                image_url: document.getElementById('editImageUrl').value,
            };

            try {
                await fetch(`/vacancies/${currentVacancyId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });
                showToast('Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾!', 'success');
                closeModal();
                loadVacancies();
                loadStats();
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        async function runWorker(action) {
            if (!currentVacancyId) return;

            try {
                const res = await fetch(`/vacancies/${currentVacancyId}/${action}`, { method: 'POST' });
                const data = await res.json();
                showToast(`Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ°: ${data.task_id}`, 'success');

                // Refresh after a short delay
                setTimeout(() => openVacancy(currentVacancyId), 2000);
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        async function deleteVacancy(id) {
            if (!confirm(`Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²Ğ°ĞºĞ°Ğ½ÑĞ¸Ñ ${id}?`)) return;

            try {
                await fetch(`/vacancies/${id}`, { method: 'DELETE' });
                showToast('Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾', 'success');
                loadVacancies();
                loadStats();
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        async function deleteCurrentVacancy() {
            if (currentVacancyId) {
                await deleteVacancy(currentVacancyId);
                closeModal();
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // IMPORT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function loadSheets() {
            const url = document.getElementById('sheetUrl').value;
            if (!url) return alert('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ URL');

            try {
                const res = await fetch('/google/sheets/meta', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                const data = await res.json();

                if (data.sheets) {
                    document.getElementById('sheetOptions').innerHTML = `
                        <div class="form-group">
                            <label>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ»Ğ¸ÑÑ‚</label>
                            <select id="selectedSheet" class="filter-input">
                                ${data.sheets.map(s => `<option>${s}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group" style="display:flex;align-items:center;gap:10px;margin-top:10px">
                            <input type="checkbox" id="saveAsSource" style="width:18px;height:18px">
                            <label for="saveAsSource" style="margin:0;cursor:pointer">ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº</label>
                        </div>
                        <div id="sourceNameField" style="display:none;margin-top:10px">
                            <div class="form-group">
                                <label>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°</label>
                                <input type="text" id="sourceName" placeholder="ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Ğ’Ğ°ĞºĞ°Ğ½ÑĞ¸Ğ¸ ĞœĞ¾ÑĞºĞ²Ğ°">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="importFromSheet()" style="margin-top:10px">ğŸš€ Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ</button>
                    `;
                    // Toggle source name field
                    document.getElementById('saveAsSource').addEventListener('change', function () {
                        document.getElementById('sourceNameField').style.display = this.checked ? 'block' : 'none';
                    });
                } else {
                    showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + data.detail, 'error');
                }
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        async function importFromSheet() {
            const url = document.getElementById('sheetUrl').value;
            const sheet = document.getElementById('selectedSheet').value;
            const saveAsSourceCheckbox = document.getElementById('saveAsSource');
            const saveAsSource = saveAsSourceCheckbox ? saveAsSourceCheckbox.checked : false;
            const sourceName = document.getElementById('sourceName')?.value || '';

            // If saving as source, validate name
            if (saveAsSource && !sourceName.trim()) {
                return showToast('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°', 'error');
            }

            try {
                // Save as source if checked
                if (saveAsSource) {
                    await fetch('/import/sources', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: sourceName.trim(), url: url, sheet_name: sheet })
                    });
                    showToast('Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½!', 'success');
                    loadSources();
                }

                // Run import
                const res = await fetch('/import/sheets', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ spreadsheet_input: url, sheet_name: sheet })
                });
                const data = await res.json();
                showToast(`Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½! Task: ${data.task_id}`, 'success');
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        async function manualImport() {
            const position = document.getElementById('manualPosition').value;
            const city = document.getElementById('manualCity').value;
            const address = document.getElementById('manualAddress').value;

            if (!position || !city) {
                return showToast('Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ', 'error');
            }

            const data = [{
                "Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ": position,
                "Ğ“Ğ¾Ñ€Ğ¾Ğ´": city,
                "ĞĞ´Ñ€ĞµÑ": address,
                "ĞĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ": "Ğ”Ğ°"
            }];

            try {
                const res = await fetch('/import/json', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                showToast(`Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½! Task: ${result.task_id}`, 'success');

                // Clear form
                document.getElementById('manualPosition').value = '';
                document.getElementById('manualCity').value = '';
                document.getElementById('manualAddress').value = '';
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COMPANY PROFILE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function loadProfile() {
            try {
                const res = await fetch('/settings/profile');
                const profile = await res.json();

                document.getElementById('profileManagerName').value = profile.manager_name || '';
                document.getElementById('profilePhone').value = profile.contact_phone || '';
                document.getElementById('profileCompanyName').value = profile.company_name || '';
                document.getElementById('profileEmail').value = profile.email || '';

                // Additional settings
                if (profile.employment_type) {
                    document.getElementById('profileEmploymentType').value = profile.employment_type;
                }
                if (profile.job_type) {
                    document.getElementById('profileJobType').value = profile.job_type;
                }
                if (profile.experience) {
                    document.getElementById('profileExperience').value = profile.experience;
                }
                if (profile.pay_period) {
                    document.getElementById('profilePayPeriod').value = profile.pay_period;
                }
                // Auto-publication schedule
                if (profile.publication_schedule) {
                    const sched = profile.publication_schedule;
                    document.getElementById('pubScheduleEnabled').checked = sched.enabled || false;
                    
                    // Set days
                    const days = sched.days || [];
                    document.querySelectorAll('.pub-day').forEach(cb => {
                        cb.checked = days.includes(parseInt(cb.value));
                    });
                    
                    // Set hours
                    const hours = sched.hours || [];
                    document.querySelectorAll('.pub-hour').forEach(cb => {
                        cb.checked = hours.includes(parseInt(cb.value));
                    });
                    
                    togglePubSchedule();
                }

            } catch (e) {
                console.error('Failed to load profile:', e);
            }
        }

        function togglePubSchedule() {
            const enabled = document.getElementById('pubScheduleEnabled').checked;
            document.getElementById('pubScheduleSettings').style.display = enabled ? 'block' : 'none';
        }

        async function saveProfile() {
            const updates = {
                manager_name: document.getElementById('profileManagerName').value,
                contact_phone: document.getElementById('profilePhone').value,
                company_name: document.getElementById('profileCompanyName').value,
                email: document.getElementById('profileEmail').value,
                employment_type: document.getElementById('profileEmploymentType').value,
                job_type: document.getElementById('profileJobType').value,
                experience: document.getElementById('profileExperience').value,
                pay_period: document.getElementById('profilePayPeriod').value,
                // Schedule
                publication_schedule: {
                    enabled: document.getElementById('pubScheduleEnabled').checked,
                    days: Array.from(document.querySelectorAll('.pub-day:checked')).map(cb => parseInt(cb.value)),
                    hours: Array.from(document.querySelectorAll('.pub-hour:checked')).map(cb => parseInt(cb.value)),
                }
            };

            try {
                const res = await fetch('/settings/profile', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });

                if (res.ok) {
                    showToast('ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½!', 'success');
                } else {
                    showToast('ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ', 'error');
                }
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // XML EXPORT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function exportXML() {
            try {
                const res = await fetch('/export/xml', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(null)
                });
                const data = await res.json();

                document.getElementById('exportResult').innerHTML = `
                    <div style="color:var(--success)">
                        âœ… Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½!<br>
                        Task ID: <code>${data.task_id}</code>
                    </div>
                `;
                showToast('Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ XML Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½', 'success');
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TOAST
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => toast.remove(), 4000);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // IMPORT SOURCES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let currentSourceId = null;

        async function loadSources() {
            try {
                const res = await fetch('/import/sources');
                const data = await res.json();
                const container = document.getElementById('sourcesList');

                if (!data.sources || data.sources.length === 0) {
                    container.innerHTML = '<p style="color:var(--text-muted)">ĞĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ñ… Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ². Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Google Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ²Ñ‹ÑˆĞµ.</p>';
                    return;
                }

                container.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</th>
                                <th>Ğ›Ğ¸ÑÑ‚</th>
                                <th>ĞĞ²Ñ‚Ğ¾-ÑĞ¸Ğ½Ñ…Ñ€.</th>
                                <th>Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</th>
                                <th>ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚</th>
                                <th>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</th>
                                <th>Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.sources.map(s => {
                    const days = ['', 'ĞŸĞ½', 'Ğ’Ñ‚', 'Ğ¡Ñ€', 'Ğ§Ñ‚', 'ĞŸÑ‚', 'Ğ¡Ğ±', 'Ğ’Ñ'];
                    const scheduleText = s.sync_schedule_type === 'daily'
                        ? `Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾ Ğ² ${s.sync_hour || 9}:00`
                        : `${(s.sync_days || [1, 2, 3, 4, 5]).map(d => days[d]).join(', ')} Ğ² ${s.sync_hour || 9}:00`;
                    return `
                                <tr>
                                    <td><strong>${s.name}</strong></td>
                                    <td>${s.sheet_name || '-'}</td>
                                    <td>
                                        <label class="toggle-switch" style="margin:0">
                                            <input type="checkbox" ${s.sync_enabled ? 'checked' : ''} 
                                                onchange="toggleSync('${s.id}', this.checked)">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </td>
                                    <td>
                                        <span style="font-size:12px;color:var(--text-muted)">${scheduleText}</span>
                                        <button class="action-btn" onclick="openScheduleModal('${s.id}', '${s.sync_schedule_type || 'daily'}', ${s.sync_hour || 9}, '${(s.sync_days || [1, 2, 3, 4, 5]).join(',')}')" title="ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ">âš™ï¸</button>
                                    </td>
                                    <td>${s.last_imported_at ? new Date(s.last_imported_at).toLocaleString('ru') : 'ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ°'}</td>
                                    <td>
                                        ${s.last_sync_status === 'success' ? '<span style="color:var(--success)">âœ…</span>' :
                            s.last_sync_status === 'error' ? '<span style="color:var(--error)" title="' + (s.last_sync_error || '') + '">âŒ</span>' :
                                '<span style="color:var(--text-muted)">â€”</span>'}
                                    </td>
                                    <td>
                                        <button class="action-btn primary" onclick="runSourceImport('${s.id}')" title="Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ">ğŸ”„</button>
                                        <button class="action-btn" onclick="editSource('${s.id}')" title="Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ">âœï¸</button>
                                        <button class="action-btn danger" onclick="deleteSource('${s.id}')" title="Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ">ğŸ—‘ï¸</button>
                                    </td>
                                </tr>
                            `}).join('')}
                        </tbody>
                    </table>
                `;
            } catch (e) {
                document.getElementById('sourcesList').innerHTML = '<p style="color:var(--error)">ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ²</p>';
            }
        }

        async function runSourceImport(sourceId) {
            try {
                const res = await fetch(`/import/sources/${sourceId}/run`, { method: 'POST' });
                const data = await res.json();
                showToast(`Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½! Task: ${data.task_id}`, 'success');
                setTimeout(loadSources, 1000);
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        async function editSource(sourceId) {
            currentSourceId = sourceId;
            const newName = prompt('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°:');
            if (newName && newName.trim()) {
                try {
                    await fetch(`/import/sources/${sourceId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: newName.trim() })
                    });
                    showToast('Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½!', 'success');
                    loadSources();
                } catch (e) {
                    showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
                }
            }
        }

        async function deleteSource(sourceId) {
            if (!confirm('Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº?')) return;
            try {
                await fetch(`/import/sources/${sourceId}`, { method: 'DELETE' });
                showToast('Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½', 'success');
                loadSources();
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        async function toggleSync(sourceId, enabled) {
            try {
                await fetch(`/import/sources/${sourceId}/sync-settings?sync_enabled=${enabled}`, {
                    method: 'PUT'
                });
                showToast(enabled ? 'ĞĞ²Ñ‚Ğ¾-ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ°' : 'ĞĞ²Ñ‚Ğ¾-ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½Ğ°', 'success');
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
                loadSources(); // Reload to reset toggle state
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SCHEDULE MODAL
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let scheduleSourceId = null;

        function openScheduleModal(sourceId, scheduleType, hour, daysStr) {
            scheduleSourceId = sourceId;

            // Set schedule type
            document.getElementById('scheduleType').value = scheduleType || 'daily';

            // Set hour
            document.getElementById('scheduleHour').value = hour || 9;

            // Set days
            const days = daysStr ? daysStr.split(',').map(d => parseInt(d)) : [1, 2, 3, 4, 5];
            document.querySelectorAll('.day-checkbox').forEach(cb => {
                cb.checked = days.includes(parseInt(cb.value));
            });

            // Toggle days selector visibility
            toggleDaysSelector();

            // Show modal
            document.getElementById('scheduleModal').style.display = 'flex';
        }

        function closeScheduleModal() {
            document.getElementById('scheduleModal').style.display = 'none';
            scheduleSourceId = null;
        }

        function toggleDaysSelector() {
            const type = document.getElementById('scheduleType').value;
            document.getElementById('daysSelector').style.display = type === 'weekly' ? 'block' : 'none';
        }

        async function saveSchedule() {
            if (!scheduleSourceId) return;

            const scheduleType = document.getElementById('scheduleType').value;
            const hour = document.getElementById('scheduleHour').value;
            const days = Array.from(document.querySelectorAll('.day-checkbox:checked'))
                .map(cb => cb.value)
                .join(',');

            try {
                await fetch(`/import/sources/${scheduleSourceId}/sync-settings?sync_schedule_type=${scheduleType}&sync_hour=${hour}&sync_days=${days}`, {
                    method: 'PUT'
                });
                showToast('Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾!', 'success');
                closeScheduleModal();
                loadSources();
            } catch (e) {
                showToast('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + e.message, 'error');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INIT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        loadStepMode();
        loadStats();
        loadProfile();
        loadSources();
        setInterval(loadStats, 30000);
    </script>
</body>

</html>